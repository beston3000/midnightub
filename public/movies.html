<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
	<title>Midnight BR0WSER</title>

	<link rel="shortcut icon" href="favicon.webp" />
	<link rel="stylesheet" href="index.css" />

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@400;500;600&family=Space+Grotesk:wght@400;700&display=swap"
		rel="stylesheet">

    <script type="module" src="midnight-core.js"></script>

	<script src="/scram/scramjet.all.js"></script>
	<script src="baremux/index.js" defer></script>
	<script src="epoxy/index.js" defer></script>
	<script src="register-sw.js" defer></script>
	<script src="search.js" defer></script>
	<script src="index.js" defer></script>

	<style>
		:root {
			--bg-color: #030508;
			--panel-color: rgba(10, 15, 30, 0.65);
			--accent-primary: #00f3ff;
			--accent-secondary: #bc13fe;
			--text-main: #e0f7fa;
			--text-muted: #627c85;
			--border-glow: 0 0 10px rgba(0, 243, 255, 0.3);
		}

		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			height: 100vh;
			background-color: var(--bg-color);
			color: var(--text-main);
			font-family: 'Rajdhani', sans-serif;
			overflow: hidden;
            display: flex;
            flex-direction: column;
		}

        /* --- AUTH STATE STYLES (Midnight Core) --- */
        .app { 
            transition: filter 0.3s; 
        }
        
        body.logged-out .app { 
            filter: blur(8px) brightness(0.4); 
            pointer-events: none; 
        }
        /* ----------------------------------------- */

		/* Background Effects */
		#starfield {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: -2;
		}

		.scanlines {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.15) 1px, transparent 1px, transparent 2px);
			pointer-events: none;
			z-index: -1;
		}

		.vignette {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: radial-gradient(circle, transparent 50%, #000000 150%);
			pointer-events: none;
			z-index: -1;
		}

		.app {
			display: flex;
			flex-direction: column;
			height: 100%;
			position: relative;
			z-index: 1;
		}

		/* --- NAVIGATION STYLES --- */
		.topbar {
			height: 70px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 0 40px;
			background: rgba(5, 8, 16, 0.8);
			border-bottom: 1px solid rgba(0, 243, 255, 0.2);
			backdrop-filter: blur(10px);
			box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
		}

		.brand {
			font-family: "Orbitron", sans-serif;
			font-weight: 900;
			font-size: 20px;
			letter-spacing: 2px;
			color: var(--accent-primary);
			text-decoration: none;
			text-transform: uppercase;
			text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
			position: relative;
			padding-left: 15px;
		}
		
		.brand::before {
			content: '';
			position: absolute;
			left: 0;
			top: 50%;
			transform: translateY(-50%);
			width: 6px;
			height: 6px;
			background: var(--accent-secondary);
			box-shadow: 0 0 8px var(--accent-secondary);
		}

		.nav {
			display: flex;
			gap: 4px;
		}

		.nav-link {
			position: relative;
			font-size: 16px;
			font-weight: 600;
			color: var(--text-muted);
			text-decoration: none;
			padding: 8px 16px;
			text-transform: uppercase;
			letter-spacing: 1px;
			transition: all 0.3s ease;
			overflow: hidden;
		}

		.nav-link:hover, .nav-link.active {
			color: var(--text-main);
			background: rgba(0, 243, 255, 0.05);
			text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
		}

		/* Futuristic Underline Animation */
		.nav-link::after {
			content: '';
			position: absolute;
			bottom: 0;
			left: 0;
			width: 0%;
			height: 2px;
			background: var(--accent-primary);
			transition: width 0.3s ease;
			box-shadow: 0 0 10px var(--accent-primary);
		}

		.nav-link:hover::after, .nav-link.active::after {
			width: 100%;
		}
		/* ----------------------------------------------- */

		/* Navbar is now visible. Hidden controls only. */
		.browser-controls, 
		.tabs-bar {
			display: none !important;
		}

		/* Viewport (The Player) - Hidden by default, acts as overlay */
		.viewport {
			display: none; /* Hidden initially */
			position: fixed;
			inset: 0;
			z-index: 100; /* On top of everything */
			background: #000;
			overflow: hidden;
		}

		.view {
			position: absolute;
			inset: 0;
			display: none;
		}

		.view.active {
			display: block;
		}

		.frame-host {
			width: 100%;
			height: 100%;
			border: none;
			background: #000;
		}

		/* Close Button for Player */
		#player-close {
			display: none;
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 101;
			background: rgba(0, 0, 0, 0.8);
			border: 1px solid var(--accent-secondary);
			color: var(--accent-secondary);
			padding: 8px 16px;
			cursor: pointer;
			font-family: 'Orbitron', sans-serif;
			text-transform: uppercase;
			letter-spacing: 1px;
			transition: all 0.2s;
		}
		
		#player-close:hover {
			background: var(--accent-secondary);
			color: #000;
			box-shadow: 0 0 15px var(--accent-secondary);
		}

		/* Trending Movies Section */
		#trending-movies {
			flex: 1; /* Takes remaining space */
			background: rgba(5, 8, 16, 0.85);
			border-top: 1px solid var(--accent-primary);
			padding: 15px 20px;
			display: flex;
			flex-direction: column;
			gap: 15px;
			backdrop-filter: blur(5px);
			position: relative;
			overflow: hidden;
		}
		
		#trending-movies::before {
			content: 'DATA STREAM // TMDB (PROXIED)';
			position: absolute;
			top: 10px;
			right: 20px;
			background: var(--bg-color);
			border: 1px solid var(--accent-primary);
			color: var(--accent-primary);
			font-size: 10px;
			padding: 2px 8px;
			letter-spacing: 1px;
		}

		.tm-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 15px;
			padding-bottom: 10px;
		}

		.tm-header h2 {
			margin: 0;
			font-family: 'Orbitron', sans-serif;
			font-size: 24px;
			color: #fff;
			letter-spacing: 1px;
		}

		/* Search Bar Styles */
		.tm-search-container {
			display: flex;
			align-items: center;
		}

		#movie-search {
			background: rgba(0, 0, 0, 0.5);
			border: 1px solid var(--accent-primary);
			color: var(--text-main);
			padding: 8px 12px;
			font-family: 'Rajdhani', sans-serif;
			font-size: 16px;
			width: 250px;
			outline: none;
			transition: all 0.3s;
		}

		#movie-search:focus {
			box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
			background: rgba(0, 0, 0, 0.8);
		}
		
		#movie-search::placeholder {
			color: var(--text-muted);
			font-size: 14px;
			letter-spacing: 1px;
		}

		.tm-scroll {
			display: flex;
			flex-wrap: wrap; 
			gap: 20px;
			overflow-y: auto; 
			height: 100%;
			padding-bottom: 20px;
			justify-content: center;
		}

		.tm-scroll::-webkit-scrollbar {
			width: 8px;
		}
		.tm-scroll::-webkit-scrollbar-track {
			background: rgba(255,255,255,0.05);
		}
		.tm-scroll::-webkit-scrollbar-thumb {
			background: var(--accent-primary);
			border-radius: 4px;
		}

		.movie-card {
			width: 180px;
			height: 300px;
			position: relative;
			background: rgba(255,255,255,0.05);
			border: 1px solid rgba(255,255,255,0.1);
			transition: all 0.3s;
			display: flex;
			flex-direction: column;
			cursor: pointer;
		}

		.movie-card:hover {
			border-color: var(--accent-primary);
			box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
			transform: translateY(-5px);
		}

		.poster-wrapper {
			flex: 1;
			overflow: hidden;
			position: relative;
		}

		.poster-wrapper img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.movie-rating {
			position: absolute;
			top: 5px;
			right: 5px;
			background: rgba(0,0,0,0.8);
			border: 1px solid var(--accent-secondary);
			color: var(--accent-secondary);
			font-weight: bold;
			padding: 2px 5px;
			font-size: 12px;
		}

		.movie-info {
			padding: 10px;
			background: rgba(0,0,0,0.6);
		}

		.movie-title {
			font-size: 14px;
			font-weight: 600;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			margin-bottom: 4px;
			color: #fff;
		}

		.movie-date {
			font-size: 11px;
			color: var(--text-muted);
		}

		/* New Tab Page (Internal) */
		.newtab {
			position: absolute;
			inset: 0;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.nt-card {
			width: min(600px, 90vw);
			padding: 40px;
			background: rgba(10, 15, 30, 0.75);
			border: 1px solid var(--accent-primary);
			backdrop-filter: blur(15px);
			text-align: center;
			position: relative;
			box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
		}

		.nt-card::before {
			content: '';
			position: absolute;
			top: -2px;
			left: -2px;
			width: 20px;
			height: 20px;
			border-top: 3px solid var(--accent-secondary);
			border-left: 3px solid var(--accent-secondary);
		}

		.nt-card::after {
			content: '';
			position: absolute;
			bottom: -2px;
			right: -2px;
			width: 20px;
			height: 20px;
			border-bottom: 3px solid var(--accent-secondary);
			border-right: 3px solid var(--accent-secondary);
		}

		.nt-card h1 {
			font-family: 'Orbitron', sans-serif;
			color: #fff;
			margin: 0 0 10px;
			letter-spacing: 2px;
			font-size: 32px;
		}

		.nt-card p {
			color: var(--text-muted);
			margin-bottom: 20px;
			line-height: 1.5;
		}

		.nt-info {
			display: inline-block;
			padding: 5px 10px;
			border: 1px solid var(--accent-primary);
			color: var(--accent-primary);
			font-size: 12px;
			text-transform: uppercase;
			letter-spacing: 1px;
			background: rgba(0, 243, 255, 0.1);
		}

		#sj-error,
		#sj-error-code {
			display: none;
		}
	</style>
</head>

<body class="logged-out" data-mode="browser">

	<canvas id="starfield"></canvas>
	<div class="scanlines"></div>
	<div class="vignette"></div>

	<div class="app">
		<div class="topbar">
			<a href="index.html" class="brand">Midnight</a>
			<nav class="nav">
				<a href="index.html" class="nav-link">Home</a>
				<a href="b.html" class="nav-link">Browser</a>
				<a href="g.html" class="nav-link">Games</a>
				<a href="apps.html" class="nav-link">Apps</a>
                <a href="chat.html" class="nav-link">Chat</a>
				<a href="shows.html" class="nav-link">Tv Shows</a>
				<a href="movies.html" class="nav-link active">Movies</a>
				<a href="music.html" class="nav-link">Music</a>
				<a href="settings.html" class="nav-link">Settings</a>
			</nav>
		</div>

		<div class="browser-controls">
			<div class="navbtns" aria-label="Navigation controls">
				<button class="navbtn" id="navBack" type="button" title="Back">âŸµ</button>
				<button class="navbtn" id="navForward" type="button" title="Forward">âŸ¶</button>
				<button class="navbtn" id="navReload" type="button" title="Reload">âŸ³</button>
			</div>
			<form id="sj-form">
				<input id="sj-search-engine" value="https://www.google.com/search?q=%s" type="hidden" />
				<input id="sj-address" type="text" placeholder="SECURE CONNECTION // ENTER URL OR SEARCH"
					autocomplete="off" />
			</form>
		</div>

		<div class="tabs-bar" id="tabs">
			<div class="tab active" data-id="1">
				<span class="label">NEW SESSION</span>
				<span class="close" title="Close">âœ•</span>
			</div>
			<div class="tab add" id="addTab" title="New Tab">+</div>
		</div>
		
		<button id="player-close">âœ• CLOSE PLAYER</button>

		<div class="viewport" id="views">
			<div class="view active" data-id="1">
				<div class="newtab">
					<div class="nt-card">
						<h1>MIDNIGHT BROWSER</h1>
						<p>Secure encrypted connection established. Tabs are isolated in containers.</p>
						<div class="nt-info">SYSTEM READY</div>
					</div>
				</div>
				<div class="frame-host" hidden></div>
			</div>
		</div>

		<div id="trending-movies">
			<div class="tm-header">
				<h2>TRENDING MOVIES</h2>
				<div class="tm-search-container">
					<input type="text" id="movie-search" placeholder="SEARCH DATABASE..." autocomplete="off">
				</div>
			</div>
			<div class="tm-scroll" id="tmdb-list">
				<div style="color:var(--text-muted); padding:20px;">INITIALIZING DATA STREAM...</div>
			</div>
		</div>

		<p id="sj-error"></p>
		<pre id="sj-error-code"></pre>
	</div>

	<script>
		const canvas = document.getElementById('starfield');
		const ctx = canvas.getContext('2d');
		let width, height, stars = [];
		const starCount = 100;

		function resize() {
			width = window.innerWidth; height = window.innerHeight;
			canvas.width = width; canvas.height = height;
		}
		window.addEventListener('resize', resize);
		resize();

		class Star {
			constructor() { this.init(); }
			init() {
				this.x = (Math.random() - 0.5) * width * 2;
				this.y = (Math.random() - 0.5) * height * 2;
				this.z = Math.random() * width;
				this.color = Math.random() > 0.8 ? '#bc13fe' : '#00f3ff';
			}
			update() {
				this.z -= 2;
				if (this.z <= 0) { this.init(); this.z = width; }
			}
			draw() {
				const sx = (this.x / this.z) * width + width / 2;
				const sy = (this.y / this.z) * height + height / 2;
				const r = (1 - this.z / width) * 3;
				ctx.beginPath();
				ctx.arc(sx, sy, Math.max(0, r), 0, Math.PI * 2);
				ctx.fillStyle = this.color;
				ctx.fill();
			}
		}

		for (let i = 0; i < starCount; i++) stars.push(new Star());

		function animate() {
			ctx.fillStyle = 'rgba(3, 5, 8, 0.4)';
			ctx.fillRect(0, 0, width, height);
			stars.forEach(s => { s.update(); s.draw(); });
			requestAnimationFrame(animate);
		}
		animate();
	</script>

	<script>
		const TMDB_API_KEY = '1d776c7ac6fbdaea19620e1d667b0670';
		const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w200';

		// Player UI Controls
		const viewport = document.querySelector('.viewport');
		const closeBtn = document.getElementById('player-close');

		// Handle Close Button Click
		closeBtn.onclick = () => {
			// Hide the player
			viewport.style.display = 'none';
			closeBtn.style.display = 'none';
			
			// Stop the video by clearing the iframe content
			const frameHost = document.querySelector('.frame-host');
			if (frameHost) {
				frameHost.innerHTML = '';
				frameHost.hidden = true;
			}
		};

		// --- RENDERING HELPER ---
		function renderMovies(movies) {
			const container = document.getElementById('tmdb-list');
			const addressBar = document.getElementById('sj-address');
			const searchForm = document.getElementById('sj-form');

			if (movies && movies.length > 0) {
				container.innerHTML = '';
				movies.forEach(movie => {
					const card = document.createElement('div');
					card.className = 'movie-card';
					
					const rating = movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A';
					const title = movie.title || 'Unknown';
					const date = movie.release_date || 'Unknown';
					
					let poster = 'https://via.placeholder.com/200x300/000000/00f3ff?text=No+Image';
					if (movie.poster_path) {
						const rawUrl = `${TMDB_IMAGE_BASE}${movie.poster_path}`;
						poster = `/api/image?url=${encodeURIComponent(rawUrl)}`;
					}

					// URL Click Logic
					card.onclick = () => {
						const targetUrl = `https://player.videasy.net/movie/${movie.id}`;
						
						// 1. Reveal the player overlay
						viewport.style.display = 'block';
						closeBtn.style.display = 'block';

						// 2. Trigger the proxy load
						addressBar.value = targetUrl;
						searchForm.dispatchEvent(new Event('submit', { cancelable: true }));
					};

					card.innerHTML = `
						<div class="poster-wrapper">
							<img src="${poster}" alt="${title}" loading="lazy">
							<div class="movie-rating">${rating}</div>
						</div>
						<div class="movie-info">
							<div class="movie-title" title="${title}">${title}</div>
							<div class="movie-date">${date}</div>
						</div>
					`;
					container.appendChild(card);
				});
			} else {
				container.innerHTML = '<div style="padding:20px; color:var(--text-muted)">NO RESULTS FOUND</div>';
			}
		}

		// --- FETCH FUNCTIONS ---

		async function fetchTrending() {
			const container = document.getElementById('tmdb-list');
			const titleElement = document.querySelector('.tm-header h2');
			
			titleElement.innerText = "TRENDING MOVIES";
			container.innerHTML = '<div style="padding:20px; color:var(--text-muted)">LOADING TRENDING...</div>';

			try {
				const response = await fetch(`https://api.themoviedb.org/3/trending/movie/day?api_key=${TMDB_API_KEY}`);
				const data = await response.json();
				renderMovies(data.results);
			} catch (error) {
				console.error('TMDB Error:', error);
				container.innerHTML = '<div style="padding:20px; color:#ff4444">CONNECTION FAILED // RETRYING...</div>';
			}
		}

		async function searchMovies(query) {
			const container = document.getElementById('tmdb-list');
			const titleElement = document.querySelector('.tm-header h2');
			
			if (!query) {
				fetchTrending();
				return;
			}

			titleElement.innerText = `SEARCH: "${query.toUpperCase()}"`;
			container.innerHTML = '<div style="padding:20px; color:var(--text-muted)">SEARCHING DATABASE...</div>';

			try {
				const response = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}`);
				const data = await response.json();
				renderMovies(data.results);
			} catch (error) {
				console.error('TMDB Search Error:', error);
				container.innerHTML = '<div style="padding:20px; color:#ff4444">SEARCH FAILED</div>';
			}
		}

		// --- INIT & EVENTS ---
		
		const searchInput = document.getElementById('movie-search');

		// Listen for "Enter" key in search box
		searchInput.addEventListener('keypress', (e) => {
			if (e.key === 'Enter') {
				searchMovies(searchInput.value);
			}
		});

		// Optional: Search immediately if input is cleared
		searchInput.addEventListener('input', (e) => {
			if (e.target.value === '') {
				fetchTrending();
			}
		});

		// Initial Load
		fetchTrending();
	</script>

	<script>
		// --- SUPPLY CHAIN INTERDICTION BLOCKER ---
		// This script hooks into the browser's creation engine to neutralize 
		// ad-generated iframes before they are even attached to the DOM.

		(function() {
			const elementToObserve = document.querySelector('.viewport') || document.body;

			// 1. THE POISON PILL
			// This function neuters any window object it touches
			const poisonWindow = (win) => {
				if (!win) return;
				try {
					// Hard overwrite of window.open
					Object.defineProperty(win, 'open', {
						value: function() { console.log('ðŸ’£ Malware attempted window.open - BLOCKED'); return null; },
						writable: false,
						configurable: false
					});
					
					// Disable executing arbitrary scripts via location
					Object.defineProperty(win, 'location', {
						get: function() { return window.location; },
						set: function(val) { console.log('ðŸ’£ Malware attempted location redirect - BLOCKED'); },
						configurable: false
					});
				} catch(e) {}
			};

			// 2. NATIVE HOOK: document.createElement
			// The ad script creates iframes to bypass blocks. We intercept that request.
			const originalCreateElement = document.createElement;
			document.createElement = function(tagName) {
				const element = originalCreateElement.apply(document, arguments);
				
				if (tagName.toLowerCase() === 'iframe') {
					// We immediately lock the sandbox of the new iframe
					// We purposefully exclude 'allow-popups'
					element.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-pointer-lock');
					
					// We also hook the 'contentWindow' getter to poison it immediately upon access
					// This stops the script from grabbing the clean window.open inside
					try {
						Object.defineProperty(element, 'contentWindow', {
							get: function() {
								const win = HTMLIFrameElement.prototype.contentWindow; // access real window if needed internally
								// But usually, we just want to poison the one they get
								poisonWindow(this.contentDocument ? this.contentDocument.defaultView : null);
								return this.contentDocument ? this.contentDocument.defaultView : null;
							},
							configurable: true
						});
					} catch(e) {}
					
					console.log('ðŸ›¡ï¸ Intercepted creation of malicious iframe');
				}
				return element;
			};

			// 3. EVENT SUFFOCATION (The "Black Hole")
			// The ad script listens for clicks on the document. We stop them here.
			const suffocate = (e) => {
				// If the target is an ad link or disguised overlay
				const target = e.target;
				const link = target.closest('a');
				
				// Block suspicious external links or invisible elements
				if (link && link.target === '_blank') {
					e.preventDefault();
					e.stopPropagation();
					e.stopImmediatePropagation(); // Stops the ad script from seeing the click
					console.log('ðŸš« Click event suffocated.');
				}
			};

			// Capture phase (true) ensures we run BEFORE the ad script
			window.addEventListener('click', suffocate, true);
			window.addEventListener('mousedown', suffocate, true);
			window.addEventListener('mouseup', suffocate, true);
			window.addEventListener('pointerup', suffocate, true);

			// 4. OBSERVER BACKUP (For iframes injected via innerHTML)
			const observer = new MutationObserver((mutations) => {
				mutations.forEach((mutation) => {
					mutation.addedNodes.forEach((node) => {
						if (node.tagName === 'IFRAME') {
							node.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-pointer-lock');
							poisonWindow(node.contentWindow);
						}
					});
				});
			});
			observer.observe(elementToObserve, { childList: true, subtree: true });

			console.log('ðŸ”’ System: Native Hooks & Supply Chain Interdiction Active.');
		})();
	</script>
</body>
</html>